$schema: "http://json-schema.org/draft-07/schema#"
$id: "v2/schema/action.schema.yml"
title: "Action"
type: "object"
description: "Atomic action"
maxProperties: 1
minProperties: 1
additionalProperties: false
properties:
  heimdall:flash:
    title: "heimdall:flash action"
    type: "object"
    properties:
      partitions:
        title: Partitions
        type: array
        description: Partitions to flash
        items:
          title: Partition
          type: object
          description: Partition to flash
          properties:
            partition:
              title: Partition
              type: string
            file:
              title: File
              type: string
            group:
              title: Group
              type: string
    additionalProperties: false
  core:info:
    title: "core:info action"
    type: "object"
    properties:
      status:
        title: Status message
        type: string
        description: Message displayed in the upper line of the footer
      dots:
        title: Dots (waiting animation)
        type: boolean
        description: Dots (waiting animation) in the upper line of the footer
      info:
        title: Info message
        type: string
        description: Message displayed in the lower line of the footer
      progress:
        title: Progress
        type: number
        description: Progress bar (omit to hide)
        minimum: 0
        maximum: 1
      speed:
        title: Speed
        type: number
        description: speed in MB/s (omit to hide)
        minimum: 0
        maximum: 5000
  core:group:
    title: "core:group action"
    type: "array"
    items:
      $ref: "step.schema.yml"
  core:user_action:
    title: "core:user_action action"
    type: "object"
    properties:
      action:
        title: User action
        type: "string"
        description: "user action to run"
        ubports_user-action:
    required: ["action"]
    additionalProperties: false
  fastboot:oem_unlock:
    title: "fastboot:oem_unlock action"
    oneOf:
      - type: "null"
      - type: "object"
        properties:
          code_url:
            title: Code url
            type: string
            description: Website to obtain an unlock code
        additionalProperties: false
  fastboot:flashing_unlock:
    title: "fastboot:flashing_unlock action"
    type: "null"
  fastboot:reboot_bootloader:
    title: "fastboot:reboot_bootloader action"
    type: "null"
  fastboot:reboot_fastboot:
    title: "fastboot:reboot_fastboot action"
    type: "null"
    ubports_installer-compatibility: ">=0.9.2-beta"
  fastboot:reboot_recovery:
    title: "fastboot:reboot_recovery action"
    type: "null"
  fastboot:update:
    title: "fastboot:update action"
    type: "object"
    additionalProperties: false
  systemimage:install:
    title: "systemimage:install action"
    oneOf:
      - type: "object"
        ubports_installer-compatibility: ">=0.9.4-beta"
        additionalProperties: false
        properties:
          verify_recovery:
            title: "Verify Recovery"
            type: "boolean"
            description: "Verify that the recovery is capable of installing Ubuntu Touch by asserting that `adb getprop ro.ubuntu.recovery`. Defaults to false."
      - type: "null"
        ubports_installer-compatibility: ">=0.9.2-beta"
  asteroid_os:download:
    title: "asteroid_os:download action"
    type: "null"
  lineage_os:download:
    title: "lineage_os:download action"
    type: "null"
  lineage_os:install:
    title: "lineage_os:install action"
    type: "null"
  fastboot:boot:
    title: "fastboot:boot action"
    type: "object"
    properties:
      file:
        title: File
        type: string
      group:
        title: Group
        type: string
    additionalProperties: false
  fastboot:reboot:
    title: "fastboot:reboot action"
    type: "null"
  fastboot:continue:
    title: "fastboot:continue action"
    type: "null"
  fastboot:erase:
    title: "fastboot:erase action"
    type: "object"
    properties:
      partition:
        title: Partition
        type: "string"
        description: "Partition to format."
    additionalProperties: false
  fastboot:format:
    title: "fastboot:format action"
    type: "object"
    properties:
      partition:
        title: Partition
        type: "string"
        description: "Partition to format."
      type:
        title: Partition type
        type: "string"
        description: "Partition type to use"
        enum:
          - ext2
          - ext4
          - f2fs
      size:
        title: Partition size
        type: number
        description: "Partition size"
    additionalProperties: false
  fastboot:flash:
    title: "fastboot:flash action"
    type: "object"
    properties:
      partitions:
        title: Partitions
        type: array
        description: Partitions to flash
        items:
          title: Partition
          type: object
          description: Partition to flash
          properties:
            partition:
              title: Partition
              type: string
            file:
              title: File
              type: string
            group:
              title: Group
              type: string
    additionalProperties: false
  fastboot:wipe_super:
    title: "fastboot:wipe_super action"
    type: "object"
    properties:
      image:
        title: Image
        type: object
        properties:
          file:
            title: File
            type: string
          group:
            title: Group
            type: string
    required: ["image"]
    additionalProperties: false
  fastboot:set_active:
    title: "fastboot:set_active action"
    type: "object"
    properties:
      slot:
        title: To state
        type: "string"
        enum: ["a", "b"]
    additionalProperties: false
  fastboot:assert_var:
    title: "fastboot:assert_var"
    type: "object"
    additionalProperties: false
    oneOf:
      - required: ["variable", "value"]
      - required: ["variable", "regex"]
    properties:
      variable:
        title: "Variable"
        type: "string"
        description: "Variable to assert using fastboot getvar"
      value:
        title: "Value"
        type: "string"
        description: "Asserted variable value"
      regex:
        $ref: regex.schema.yml#
  adb:shell:
    title: "adb:shell action"
    type: "object"
    description: Run a command on the device via adb shell
    properties:
      args:
        title: Arguments
        type: "array"
        description: "Shell arguments"
        items:
          type: string
    required: ["args"]
    additionalProperties: false
  adb:reboot:
    title: "adb:reboot action"
    type: "object"
    properties:
      to_state:
        title: To state
        type: "string"
        description: "State to rebot to."
        enum:
          - "recovery"
          - "system"
          - "bootloader"
    required: ["to_state"]
    additionalProperties: false
  adb:format:
    title: "adb:format action"
    type: "object"
    properties:
      partition:
        title: Partition
        type: "string"
        description: "Partition to format."
    additionalProperties: false
  adb:sideload:
    title: "adb:sideload action"
    type: "object"
    properties:
      file:
        title: Zip to sideload
        type: string
      group:
        title: Group
        type: string
    required:
      - file
      - group
    additionalProperties: false
  adb:push:
    title: "adb:push action"
    type: "object"
    properties:
      files:
        title: Files
        description: File names to push
        type: array
        items:
          type: string
      group:
        title: Group
        type: string
      dest:
        title: Destination path
        description: Path on the device to push files to
        type: string
    required:
      - file
      - group
    additionalProperties: false
  adb:preparesystemimage:
    title: "adb:preparesystemimage action"
    type: "null"
  adb:assert_prop:
    title: "adb:assert_prop action"
    type: "object"
    additionalProperties: false
    oneOf:
      - required: ["prop", "value"]
      - required: ["prop", "regex"]
    properties:
      prop:
        title: "Property"
        type: "string"
        description: "Property to assert using adb getprop"
      value:
        title: "Value"
        type: "string"
        description: "Asserted property value"
      regex:
        $ref: regex.schema.yml#
    ubports_installer-compatibility: ">=0.9.4-beta"
  core:download:
    title: "core:download action"
    type: "object"
    properties:
      group:
        title: Group
        type: "string"
        description: "Files group"
      files:
        title: Files
        type: "array"
        description: "Array of files to download."
        items:
          title: File
          type: "object"
          properties:
            url:
              type: string
              description: URL of the file to download
            name:
              type: string
              description: Name to save the file under on disk
            checksum:
              $ref: checksum.schema.yml#
          required: ["url"]
          additionalProperties: false
    required:
      - group
      - files
    additionalProperties: false
  core:write:
    title: "core:write action"
    type: "object"
    properties:
      group:
        title: Group
        type: string
      file:
        title: File
        type: string
      content:
        title: Content
        type: string
    additionalProperties: false
  core:unpack:
    title: "core:unpack action"
    type: "object"
    properties:
      group:
        title: Group
        type: string
      files:
        type: array
        items:
          type: object
          properties:
            archive:
              title: Zip to sideload
              type: string
            dir:
              title: Target directory
              type: string
    additionalProperties: false
  core:manual_download:
    title: "core:manual_download action"
    type: "object"
    properties:
      group:
        title: Group
        type: "string"
        description: "Files group"
      file:
        title: File
        type: object
        description: "File to download"
        properties:
          url:
            type: "string"
            description: "URL of the file to download"
          checksum:
            $ref: checksum.schema.yml#
    additionalProperties: false
